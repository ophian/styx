Version 2.3 ()
 ------------------------------------------------------------------------

  * Fix SQL path REGEX matching media thumbs for the directory dir type
    only, which fixes the matching entries and the counter.

  * Fix path handler for the media-directory-form renaming existing
    directory names.

  * Fix PHP7 Exception call in Cookie based login failures

  * Add new Serendipity Smarty modifier "|cleanChars" for cases, where
    chars like dots, bangs, spaces, ... which are not (A-Za-z0-9_-)
    break the expected behaviour. Already used in the backend to fix
    broken info button cases by certain plugins.

  * Remove category filter in backend entry form categories compact mode

  * Add some styled love to comments/trackbacks/pingbacks section in the
    "Next"-theme as an example. Thanks to Grischa Brockhaus! :)

  * Fix old bug, missing the links "comment url" in the "comments.tpl"
    template file, when called by "/comments/" or "/comments/trackbacks/"
    or "/comments/comments_and_trackbacks/" etc. page shortcuts, via the
    comments_by_author.tpl template file. All relying themes [2k11,
    bulletproof, clean-blog, default-php, default, kubrick, next, timeline]
    were changed.

  * Optimise FRONTEND COMMENTS for logged-in users. They now are able
    to "multi-comment" without page reset in the "entries.tpl" template
    file. The "2k11" and the "next" theme were changed to support this.

  * Optimise PINGBACK markup generation checkup in the "trackback.tpl"
    template file, by checking a possible non-empty body variable
    starting with an image.
    This issue probably is added by the gravatar event plugin only.
    The "2k11" and the "next" theme were changed to support this.

  * Finalise 'stable' over 'beta' preference autoupdate check

  * Fix the autoupdate final "return to backend" link


Version 2.2 (2017-06-23)
 ------------------------------------------------------------------------

  * Rewrite Trackback HTTP Requests and logging attempts
    Possible logging may get enabled by hand in comments.php and by the
    "Log Level": "Debug" option in the General Configuration.
    This may change in future, to only support the latter.

  * Revisited the "TRACKBACK_SPECIFIC_ON_CLICK" constant to clarify
    trackback and trackback URI link usage.
    All depending themes in core where changed and set to a new
    date: 2017-06-21. Most languages already translated in the past were
    reset. "EN" and "DE" are up to date. Translators welcome!
    Please check your themes "entries.tpl" file for the change.

  * Fixed wrong logic checking moderation and unset emailing options
    for Comments and Track/Pingbacks. NO set "Send [..] announcements"
    in Personal Preferences really means NO EMAIL.

  * Spend some love to backend comments list for a better distinction
    of Comments/Trackbacks/Pingbacks.

  * Extend Modemaintain Plugin for security

  * Optimise Maintain section messages

  * Add temporary Serendipity bugfix for Smarty modifier compiles

  * Update this NEWS file documentary for the MySQL full unicode
    implementation "bug" down below by a marked "JUNE 2017" part.

  * Sync and enhance: Add backend_view_entry hook, that is executed for
    every entry in the backend entry list.

  * Sync: Emit and detect rel=trackback element to find trackback
    url, to have a reliable alternative to RDF used so far.

  * Bugfix upgrade to Smarty 3.1.32-dev-11

  * Sync: Updated entryproperties plugin to support a custom property
    for multiple ownership of an article.

  * Improve the Dashboards "no default widget" option, to show shortcut
    links and amounts of comments approval, future or draft entries.

    EDITORS NOTE:
        DRAFT set entries should really be used some day, published
        or rewritten with a new date and NOT kept forgotten!

  * Update simplepie library to v.1.5. Requires new file name to call:
        require_once S9Y_PEAR_PATH . '/simplepie/SimplePie.php';

  * Add random_bytes() and random_int() polyfill for PHP5, which is used
    for the author token hash to use the best and most safely available
    random generator for Integers and Strings in PHP.

  * Fix some more PHP 7 errors and fix some default-php theme templates

  * Added a new "view" type 'entries', in case the blog entries list is
    not the actual startpage. This is with a staticpage set to be the
    new 'start' page of your blog. The Smarty {$view} variable would
    then be the same for the entries list and the new staticpage
    "startpage" and you would have had to check this by eg.
        {if $view == 'start' AND $staticpage_pagetitle != 'startpage'}
    or anything similar, depending the case to check for.
    In this static page case, the entries list since ever is called by
    GET "/?frontpage" or "index.php?/frontpage" requests.

    This exactly is the case where "view:start" changes to "view:entries"
    for the list, eg {if $view == 'entries'} in your theme.
    Please check your themes index.tpl file for possible conflicts.
    All core delivered themes have been changed accordingly.
    If you don't use the staticpage start (page) option, you have no need
    to change your theme immediately.

  * Allowed <p> tag custom classes in ckeditor js config to the
    Extra Allowed Content protection against ACF.

  * Smartify quicksearch form by option (default false).

  * Optimise visual highlight of installed plugins, including those
    being installed and stackable, in lists of installable plugins.

  * Fix the experimental core cache option by recognising more states.
    This removes the second part of this code, the cached html output,
    and focuses on its first part, the internal cache to not repeat
    specific database queries.
    PLEASE see this still as an EXPERIMENTAL approach!

  * Fix spamblock Akismet API request Error

  * Change default value for "use_autosave" to false

  * Merge Smarty 3.1.32-1: Fix compiling isset() and empty() functions
    for differing PHP behaviour since PHP 5.5.

  * Sync and fix:
    Added secure installer with a token, manually created inside a file.
    This is to prevent unauthorized installation access at the very
    moment of install. Just follow the guided steps!

  * Enhance search request results on installable plugins.
    Remove plugins_installable group head names, if no inner element
    was found to display by the javascript search routine.

  * INFO:
        - Safety first. Admins are strongly requested to use the new
          modemaintain plugins "503 maintenance mode", when performing
          upgrades to the Styx system. This will keep everybody away
          until the upgrade and the upgrade tasks have run through
          with success!

  * Due to longstanding networking issues with netmirror.org, the
    default mirror of the Spartacus plugin was changed to use github.
    This will not touch Styx, since it uses the custom Styx github
    mirror by default.

  * Fix odd Chrome line break issue with MediaLibrary item titles and
    the multidelete form_check box.

  * Sync: Fix comment preview for logged-in user overwriting user data

  * INFO:
        - No sync for adding a "delete" button to the backend entry form.
          Styx does not want to overload the entry form with tasks that
          can better be done in the entry list.
        - No sync for including the PEAR Net/DNS2 lib. Currently it seems
          ridiculous to add a 84 file lib, while some old plugins are out
          of date. See: serendipity_event_spamblock_(rbl/surbl).

  * Sync: "Suppress empty groups in plugin list" issue, which only
    matters with the Serendipity origin additional_plugin repository.

  * Make backend page tab title order configurable.
    The default (tab) title of backend pages in Styx is in this order:
        "section | $admin | blog title"
    You are now able to change the order to "blog title | section | $admin"
    by adding "$serendipity['backendBlogtitleFirst'] = true;" to your
    serendipity_config_local.inc.php file.
    [Post Scriptum: Or use the backend template approach. See the Styx
     backend theme info layer.]

  * Minor changes to staticpage breadcrumb regarding separator spaces
    in all themes and staticpage templates files which use "$crumb".
    Please keep your copy templates synced.

  * Fix non accessible SQLite database without notice issue (#427).
    A forced check now is announced to the Dashboard after login.

  * Fix themes entries.pl:
    Do not allow to echo NO ENTRIES TO PRINT if view is a 404 page.

  * Enhance maintenance modemaintain (plugin) notification

  * Enhance and add maintenance (entryproperties) cache notification

  * PHP 7+ will now use random_bytes() for the author token hash, to
    generate cryptographically secure pseudo-random bytes. The older
    now seeds better with the Mersenne Twister random number generator.

  * PHP 7+ will now use openssl en-/decrytion for the cookie based login
    authentication instead of the deprecated and outdated mcrypt library.

  * Fix wrong counting limitation to 4 drafts in the Dashboard, if no
    future entries are available. As already stated in the 2.1-beta1
    notes, there are variables available which can influence the
    Dashboard entry limit (default: 5).

  * Fix missing escapement in the "next" theme staticpage.tpl file
    array vars *.top.topp_name and *.top.exit_name.

  * Silence deprecated mcrypt_* login warnings with PHP 7.1.x ++
    versions until this will be replaced.

  * Add backend theme admin/doc directory for backend based lang
    documentary per template files, cached(!) by Smarty.
    The Dashboard Quicktip section uses it already.

  * [Security] Add and check CSRF token for setting themes

  * Core CKEditor: Allow ul tag styles & classes to protect against ACF

  * Fix non-asssigned Smarty var in upgraderResultDiagnose, thanks to
    Pascal Uhlmann (webcompas).

  * Allow the Dashboards autoupdate messaging to admin users only and
    check if the autoupdate plugin actually is installed.


Version 2.1 (February, 24th 2017)
 ------------------------------------------------------------------------

  * Fix the "SERENDIPITY_NEEDS_UPGRADE" page redirector to allow admins
    only. This keeps a 503 Maintenance Mode fully intact, until freed.

  * Allow unicode searches for Chinese / Japanese like languages, see:
        https://board.s9y.org/viewtopic.php?f=4&t=15112
    This also helps when using the full unicode approach described
    below in 2.1-beta1.

  * Add upgrade task to remove possible old compiler file leftovers
    in root of templates_c, caused by Smarty2.

  * Add upgrade task to purge empty directory leftovers in
    templates_c, primarily caused by Smarty.

  * Add entry language status to the entries list, if the multilingual
    event plugin is installed and actually used by entries.

  * Fix the ChangeLog for the charset symbol text issue.
    Please read about this carefully in the 2.1-beta1 changelog entry
    down below.

  * Add new backend plugin grouper constants for group bag consistency.
    Changed:    'BACKEND', -> 'BACKEND_ADMIN',
    Added:      'MAINTAIN' -> 'BACKEND_MAINTAIN',
                'DASHBOARD' -> 'BACKEND_DASHBOARD'

  * Introduce a new html_nugget plugin option, to exclude a staticpage
    set startpage, if the staticpage plugin is installed.

  * Introduce new selector(s) to all theme "plugin_contactform.tpl"
    template files, delivered by core:
        "serendipity_staticpage staticpage_plugin_contactform"
    This enables to disallow plugin to form hooked messages,
    which don't make sense here. Example style via user.css:

        .staticpage_plugin_contactform .serendipity_comment_emoticate,
        .staticpage_plugin_contactform .serendipity_comment_gravatar,
        .staticpage_plugin_contactform .serendipity_comment_s9ymarkup,
        .staticpage_plugin_contactform .serendipity_comment_spamblock {
            display: none;
            visibility: hidden;
        }

    In some of these themes allowed only, if the plugin_contactform
    articleform option is set true.
    Please update your COPY-THEMES including this file!

  * Fix CKEditor default content styles loading

  * Fix plugin API save/preview event to not execute the DOM listener
    if $serendipity['use_autosave'] is not set.

  * Keep maintenance mode privateVariables on upgrade, since we do not
    want the public to access the update page.


Version 2.1-rc1 (January, 30th 2017)
 ------------------------------------------------------------------------

  * Add experimental Dashboard quicktip, bundled with the S9y link box.
    This is available within the forced embedded elements option only.
    New installs have this already set by default in Personal
    Preferences.

  * Add experimental modemaintain plugin, activated on install.
    Upgrade Admin Users have to install it manually via plugin list.

  * [Security] Fix missing integer casting for inserting new categories
    (thanks to cdxy)

  * Spamblock fix for the missing captcha generation in combo with the
    adduser plugin.

  * Disable adduserform hooked spamblock notifications via
    style_fallback.css

  * Add tag and category list anchors to edit_entry fieldsets

  * Disabled Selenium test files unless enabled

  * Various more Styx backend GUI improvements

  * Fix issue #437 - Remove the hardcoded media filter only_filename
    input field and re-allow the $order_fields['i.name'], which (now)
    has the same partial search functionality in the filter panel.
    This sets "only_filename" deprecated.

  * [Security] Check for CSRF token when disabling/enabling comments
    toggle

  * [Security] Add comment deletion token check against CSRF,
    if is_entry_owner via comment.php

  * [Security] Redirection of comment.php now checks the referrer
    and only allows the blog's host (thanks to Lee Sheldon Victor)

  * [Security] [#435] Secure HTTP_REFERER message, to prevent possible
    XSS in trusted area, thanks to Shinkurt

  * Cleanup of old and deprecated theme(s) admin files.

    FROM NOW ON, the Backends image fallback has moved to the "default"
    -theme admin directory.
    The serendipity_editor.js.tpl in "default/admin" and its dependent
    php files NOW are a fully available fallback stack file. Only some
    themes, like the STANDARD "2k11"-theme" or the "default-php" theme
    will fetch their own file occurrence.
    This all AND the revision for responsiveness corrects the "default"
    -theme to occur as something outdated, or no longer in common and
    restores the original weighting.

  * Touched all preview_iframe template files again for error message
    markup.

  * Allow to set a default category for authors (personal preferences)

  * Changed how the hidden password element is displayed to prevent
    browsers from autofilling it into the entryproperties plugin

  * Fix MediaLibrary image popUp dimensions not equal file dimensions

  * Fix MediaLibrary image scale return to show up the tools
    metaActionBar


Version 2.1-beta-3 Styx (December 19th, 2016)
 ------------------------------------------------------------------------

  * Upgrade to Smarty 3.1.31

  * Various Styx GUI improvements

  * [Security] - See 2.0.6 Note:
    Security bugfix to escape dbType parameter on first installation

  * Fix pubDate and add the better S9y logo to the RSS outfile

  * Revisited the old "default"-theme and its cloned "default-php"-
    theme for mobile first responsiveness, without a total rewrite,
    keeping the origin simplicity.
    The old default index.tpl file was backported to the dependency
    themes (blue, idea and default-rtl). COPY-THEMES, based on them,
    need to include this too.

  * Add upgrade task (again) to rename internally used plugins for the
    stable Styx release

  * Synced/Added new API wrapper serendipity_request_url() to request
    URLs for compat. Styx plugins currently still use the simpler Styx
    approach.
    Core Image hotlink requests do now support this new API method.

  * Fix #430 RSS set email by config, thanks to fugue88

  * Smarty bugfix and optimization update to 3.1.31-dev/47

  * [Security] - See 2.0.5 Note:
    Enhanced media upload check to also check redirects for local files

  * [Security] - See 2.0.5 Note:
    Prevent XSS in adding category and directory names

  * Add back button to scale image page

  * Fix BASE_DIRECTORY option in case of hideSubdirFiles

  * Fix extended filter action buttons shown when no entries available

  * Fix plugin API instance token

  * Fix installer iconfont issue

  * Add Styx backend template example index,  which enables to suppress
    the Serendipty and PHP version information and assets for unlogged
    users.

  * Partial Sync - flexbox backend solution

  * Sync core iconfont acessibility fixes

  * Fix and optimize Plugin description

  * Fix and optimize "default-php"-theme empty preview call

  * Bugfix update to Smarty to 3.1.31-dev/32

  * Enhanced themes info.txt descriptive notes

  * Added example Styx BACKEND theme

  * Optimized preview_iframe template files (default, 2k11, Next,
    Skeleton, Bulletproof and default-php)

  * Update CKEditor to 4.5.11 and extend with the autogrow plugin,
    which allows a flexible size of textareas.


Version 2.1-beta2 Styx (September 26th, 2016)
------------------------------------------------------------------------

  * [Security] - See 2.0.4 Note:
    Prevent moving files by using their directory name.
    Possible SQL injection for entry category assignment.
    Possible SQL injection for removing & adding a plugin.

  * [Security] - See 2.0.4 Note:
    Add new configuration option to enable fetching local files for
    the media uploader. By default this is now disabled to prevent
    Server Side Request Forgery (SSRF).

  * Added redirector message for "Page not found".

  * Added new theme "Skeleton".  Skeleton is a responsive, mobile first
    HTML5/CSS3 theme built on the Skeleton framework.

  * Update to Smarty 3.1.31-dev/23

  * Added two API functions for strpos() array neddles and
    debugging referer parent level function name.

  * Fix bug in get URI arguments where uniqueness is bad

  * Send fatal errors to the Serendipity Exception handler

  * Fix compatibility bug preventing Internet Explorer (+Edge) to
    clear the entry editor autosave cache when saving an entry.

  * Sync some Smarty bugfix updates 3.1.31-dev/12

  * Add all RFC 2616 methods to the serendipity REQUEST2 wrapper


Version 2.1-beta1 Styx (September 3rd, 2016)
------------------------------------------------------------------------

  * Added serendipity_comment_author_self class to standard 2k11 theme

  * Converted all core release themes to use Smarty3 syntax

  * Touched template files "plugin_staticpage_*" in 2k11, bulletproof
    and Next theme to support the new navigational structures of
    Staticpages v.5.x.
    Clean-blog and timeline need some review from its author.

  * Fixed and enhanced comments.tpl vars via comments_by_authors.tpl
    template file to get proper results for "*_self" class issues, since
    outside of entries.tpl scope.

  * Fixed Smarty $entry scope for comments.tpl "*_self" class issues,
    in entries.tpl to {assign var="entry" value=$entry scope="root"}
    for proper propagation of $entry to "sub"-templates.
    PLEASE UPDATE your theme or custom template copies!

  * Restrict comments author names a little more

  * Fix backend commentreply by adding an admin template (d2b1dd9c)

  * Fixed routing refactoring for uri argument checks on comments page
    pagings, and multiple others before, like multiauth and multicat,
    week and archive path, or categories rss match and lots of older
    uri fixes.

  * Re-integration of two very unique themes, which are default-php and
    default-xml. Both were reworked for Serendipity 2.1 Styx Edition and
    particularly in case of the PHP-theme heftily extended with all kind
    of other template files. Both themes use the core included
    include/template_api.inc.php file as an emulator class for the still
    overall used Smarty engine. The XML-theme is meant for Blog output
    as XML for XML-Readers. The PHP-theme is meant for all Blog
    Administrators to use or create a ("Smarty independent") PHP-theme
    only.
    The theme preview files just advert to the fallback usage binding of
    the default-theme stylesheet style.css file. In case of the PHP-theme,
    you may just want to create your own. The PHP-theme may also still
    miss some plugin template files and the XML-theme may still have some
    minor isues in the backend.
    You are very welcome to help making this more bulletproof!

  * Fixed an old issue with the default fallback template not reading the
    full serendipity_editor.js.tpl file. An already parsed fallback was
    added and updated, as well as a PHP parsable file, which is only used
    by the XML-theme.

  * Removed composer for ckeditor, since being a library which requires
    maintaining. This moved the whole library path one directory up.

  * While developing Serendipity Styx Edition, some minor UI styling
    enhancements in the backend all over have been added or changed.

  * Update Smarty lib to Smarty 3.1.31-dev/4 since the release version
    had a compiling issue that could hit Styx on upgrade

  * Allow maintenance log view plugin to delete old log files

  * Upgrade core CKEDITOR lib to ckeditor_4.5.10_full

  * Add backend comments list first / last pagination buttons

  * DEV-NOTE: enabling Zend-Db in include/db/db.inc.php is still marked
    EXPERIMENTAL, since having known issues.

  * Fixed serendipity_db_in_sql() function in generic wrapper file with
    Zend-Db adding bloat to the query part, trying to be smarter.

  * Removed Text/wiki lib from bundled-libs to be included to the wiki
    plugin instead of bundled within the core

  * Fix Zend-Db (mysql) exception issue with Serendipity using CAST(expr AS type)
    type conversions on issueAutologin() and commentSubscription DELETE
    queries.

  * Removed old executable composer.phar file from Serendipity root.
    This saves some Bytes and was never actively maintained!
    Developers may just drop their own fresh executor by hand.

  * Fix another Zend-Db issue adding a wrong key for the Smarty
    $totalEntries assignment

  * Fix serendipity_db_limit($offset, $limit) paginator function in the
    Serendipity generic wrapper file for Zend-Db, which had issues with
    Serendipity SQL offset-limit-string query parts within all Zend-Db
    2.2.x versions.

  * Update Zendframework Zend-Db to version 2.2.10 to fetch at least
    some security flaws in old 2.2.2 package
    (This too without touching composer and old json files)

  * Allow the Maintenance - changelog widget to also open up log files,
    set with $serendipity['logger'].

  * $serendipity['logger'] - fix logging encoding when using constants
    (currently only Spartacus and a critical database logging effected)

  * Update psr/log and katzgrau/klogger libs to current masters
    (without touching composer)

  * Moved backend comments action-bar to the right

  * Update Smarty lib to Smarty 3.1.30 release.
    See change notes in Smarty 3.1.30-dev commit note down below.

  * Changed Personal Preferences popup-window/force-popup option
    constants to better reflect the embedded mode for some elements

  * Changed weight and iconize backend comments shortened title line

  * Fix backend comment bodies. Summary-truncation is now stricly set to
    120 chars and always showed stripped. Else, if comment.summary was
    stripped, allow excerpt button switch to comment.fullBody.

  * Add maintenance "serendipity_event_changelog" widget, active by core.
    Upgrade Admin Users have to install it manually via plugin list.

  * Fix WYSIWYG editor languages by changing the lang constant defines
    for WYSIWYG_LANG to the POSIX locale standard formatting of language
    tags, eg "en_US". This is better to handle than the IETF language
    Unicode standard tag eg. "en-US" using a dash.

  * Add and set a new global full path variable to the Spartacus plugin,
        $serendipity['spartacus_cachedXMLfile']
    to easily be able to nuke the current package_***_**.xml cache file,
    eg. within a possible plugin 'backend_plugins_update' redirector hook
    in need to exit the current upgrade runtime execution. This would
    reset any pending plugin version settings and their listing until
    next run. Thus it'd need a new xml cache file fetch.

  * Add theme engine information to the themes list info layer

  * Allow missing {$templatePath} Smarty variable globally set, to fix
    and extend the following issues:

    - If a theme has its own preview_iframe.tpl file, it needs to
      distinguish between the backend theme with {serendipity_getFile ...},
        eg. {serendipity_getFile file="admin/js/modernizr.min.js"}
      and its very own files without using the fallback template cascade.
      These files can now be loaded locally by
        {$serendipityHTTPPath}{$templatePath}{$template}/***
      or http-wise with
        {$serendipityBaseURL}{$templatePath}{$template}/***
      and have been fixed for these themes:
        [ <next>, <clean-blog>, <bulletproof>, <timeline> ]
      within this release.
      For THEME-COPIES please remember, that files from <2k11> are
      "special", since being the standard $serendipity['defaultTemplate']
      template, which does not need this care.

    - If a frontend theme needs to link, or includes assets which might
      be problematic using the template fallback cascade, it may now
      use these fully assigned path variables, eg for the favicon:
        {$serendipityBaseURL}{$templatePath}{$template}/favicon.ico

  * Fixed <bulletproof>, <default> and <next> themes iframe_preview.tpl
    files not showing up correctly on mode: 'save' in the backend.

  * Fix a possible <bulletproof> config loading error on theme change,
    regarding serendipity_plugin_api_event_hook already used.

  * Fix and simplify templates loop key chaining for latest Smarty

  * PLEASE NOTE:
    A while ago phpMyAdmin versions 4.0+ changed their behaviour for
    tables edit handling, for database tables not having a unique key.
    You now may edit or create the/a phpMyAdmin config.inc.php file for
    PMA versions from 4.5 and set:
       $cfg['RowActionLinksWithoutUnique'] = true;
    to be able to edit some of the tables used in Serendipity again.
    References:
    https://github.com/s9y/Serendipity/issues/341
    https://docs.phpmyadmin.net/en/latest/setup.html#manually-creating-the-file
    https://sourceforge.net/p/phpmyadmin/bugs/4963/

  * Add Plugin Update Notifier serendipity_event_plugup plugin

  * Fix upgrader to not run upgrade tasks for versions higher than the
    upgrade version.

  * Fix and set strict S9Y_PEAR_PATH . to all relative PEAR package
    requirements, due to requirement errors.

  * Add ability to set and download a custom Serendipity autoupdater
    download file and get notifications for this upgrade URL in the
    Dashboard. This adds a new config option to configuration - general
    settings.

  * Fix Spartacus plugin for custom mirror (GitHub) cases.
    This is currently used for plugin(s) cases only!
    Templates are fetched from the originated mirror(s).

  * Fix case $serendipity['short_archives'] SQL query fetch in
    serendipity_fetchEntries(), if a themes entries_summary.tpl file
    wants to use a body teaser.

  * Allow "title quoting" in backend entries overview title link,
    but keep escaping for security, using double_encode false.

  * Fix issue (#340) - missing newly created entry id re-added back
    to entry form for follow-up submits of the same entry.
    Please check your template "preview_iframe.tpl" file to execute
    this code in the html head part:
+    {if isset($lastSavedEntry) && (int)$lastSavedEntry}
+
+        <script type="text/javascript">
+            window.onload = function() {ldelim}
+                parent.document.forms['serendipityEntry']['serendipity[id]'].value = "{$lastSavedEntry}";
+            {rdelim};
+        </script>
+    {/if}
+
    and remove the starting + signs.
    This issue is already fixed within the following pre-delivered
    themes: "2k11, default, bulletproof, clean_blog, next".
    Please make sure to update your themes "preview_iframe.tpl" file!
    This adds a native javascript delayed (lazy) load execution versus
    the previous used $(document.ready) and/or missing jquery loading.
    Now the iframe_preview tpl file really updates the entryform hidden
    serendipty[id] value for direct further-on-submits to that entry!

  * Partial fix a possible charset/symbol/database issue, that text
    after UTF8 'private use area' symbols was cut OFF on saving (#394).
    This partial fix applies to entry and comment bodies.

    SADLY, this depends to your (MySQL) Database, its version and also
    the tables/fields COLLATION settings. Even the maximum length of
    columns and index keys play an important role when changing this
    by Serendipity default. This is why we stick with we have for now.
    If you still want to use this better UTF8 support, you have to
    make your hands a little dirty and follow the here described
    procedure by 3 steps.

    PLEASE NOTE: This is about MySQL and old or false set charset
                 collations.

     1. The (old) MySQL utf8 encoding is awkwardly named, as it is
        different from proper UTF-8 encoding. Check up your version.
        MySQL 5.5.3 (up from 2010) introduced a new encoding called
        utf8mb4, which maps to proper UTF-8 and thus fully supports
        Unicode. If it is not set to "utf8mb4" by default, you should
        change it generally by this command:
            ALTER DATABASE database_name CHARACTER SET = utf8mb4 COLLATE = utf_unicode_ci;
        Because of the Serendipity tables unchanged columns length and
        indexes (*), we stick to "utf_unicode_ci" and do NOT use
        COLLATE = utf8mb4_unicode_ci; here.

        (*) The MySQL UTF-8 character set actually only supports 3-byte
            characters. This leads to a maximum limit of 765 byte indexes.
            However, the utf8mb4 character set and utf8mb4_general_ci
            collation introduced support for 4-byte characters, and thus
            the full set of UTF-8 characters. This is when we hit length
            errors, since the new maximum index length on a VARCHAR(255)
            field becomes 1020 bytes for example. It would need to be a
            VARCHAR(191) to stay below the 767 byte limit. As you can
            see here, this is NOT trivial to change and error prone, to
            be that robust as it has ever been.

     2. To set the connection’s COLLATION to "unicode" instead of
        "general" you have to convert these tables by using "SET NAMES
        ... COLLATE ...".
        You only need to use this better "utf8_unicode_ci" collation
        for special characters sorting (*), otherwise you can stick to
        use the old "utf8_general_ci", which is slightly faster as the
        manual says. This only is relevant to the tables which actually
        store (utf8) text data, like *_entries, *_comments and
        *_entryproperties, *_staticpages, etc.
        Example for the changes:
            ALTER TABLE `s9y_comments` DEFAULT CHARSET=utf8 COLLATE utf8_unicode_ci;
            ...

        By default a new Serendipity (UTF-8) installation should already
        be set to use the "utf8_unicode_ci" collation.

        (*) Likewise ß=ss; utf8_unicode_ci uses the Unicode Collation
            Algorithm as defined in the Unicode standards, whereas
            utf8_general_ci is a more simple sort order which results
            in "less accurate" sorting results.

     3. At last, the Serendipity "Configuration / Database Settings /
        Enable DB-charset conversion" option must be set to "No" to
        allow this to work!
        This also is the recommended setting, if you want to allow
        (full) unicode symbols at all. You may face encoding issues with
        old entries now. Check them up and try to save them again. Also
        regard possible cached entries via entryproperties.

    THE TRICK, in short:
        Without these mentioned database changes, the S9y option change
        set to "no" would just produce wrong encoded Umlauts/UTF-8.
        In the old days of changing from native latin1 to utf8 charsets,
        this option, per Serendipity default set to "yes", enabled to
        workaround a bunch of possible errors.
        The changes in the database in step 1 + 2 now enable us to NOT
        face the cut OFF text issue after these symbols any more.
        The unset Serendipity option, NOT to use SET NAMES, enables a
        better automated, modern handshake between server and database.
        At this point, these characters and symbols are actually stored
        in native UTF-8, eg. 'Ã'+'¼' for "ü".
        But since there are way too much possible settings/issues
        around, which may play a role, and not have been mentioned
        here, please see this approach as "EXPERIMENTAL" and at your
        own risk!

        PLEASE NOTE (JUNE 2017):
            There may be a better solution, updating the Serendipity table
            collations with recent mysql versions. This is supposed to come
            with upcoming Styx 2.3+, since that needs some very deep cared
            testing.

        For more about this in general, read:
            https://mathiasbynens.be/notes/mysql-utf8mb4

  * Updated some bundled libs to better support PHP 7

  * Update entryproperties grouping grid option boxes. Please configure
    the sort placed options in the "Entry editing screen" to fit nicely
    into the backend entries entry form.

  * Update the spartacus_remote url option to support a hidden
    (obfuscated) URI for the serendipity_event_plugup plugin, which adds
    an upgrade note for Spartacus plugin updates to the Dashboard.

  * Restrict category author permissions

  * Set a new option to "personal preferences" user options, to show
    no default widgets (draft entries and comments) in the Dashboard.

  * Fix an old bug with {serendipity_showPlugin
    id="serendipity_plugin_freetag:<the-hash>" side="right"
    negate="true"}
    in the functions_smarty.inc file, since the parameter
    $params['negate'] had never being read and returned correct.

  * Add Smarty 3.1.30-dev and rework the functions_smarty.inc file.
    Smarty 3.1.28 introduces run time template inheritance *
    Read the NEW_FEATURES and INHERITANCE_RELEASE_NOTES file for recent
    extensions to Smarty 3.1 functionality

  * Fix clearCompiledTemplate() needs template name

  * Korean localization lang updates

  * Add new config variable $serendipity['cors'] to allow to set
    Access-Control-Allow-Origin: * headers for sensible places
    (RSS feeds), to i.e. allow JavaScript's XMLHTTPRequest to read
    those feeds.

  * Introduce a section with modern recommended themes in the
    themes backend menu. Themes can be included there by setting
    Recommended: Yes in their info.txt

  * Merge sidebar and event upgrade pages in one single page button

  * Add colorpicker as possible plugin option item type, set
    type to 'color' to use it

  * Comments made via the backend on own articles don't trigger
    the comment notification (thanks to xoxys)

  * Fix missing perm checks for "standard user" in MediaLibrary

  * Fix show Dashboard entries by authors entries

  * Fix show Dashboard comments by authors entries (#385)

  * Use CDATA encoded body for ATOM feed

  * Fix: Ajax upload to ML now also works for non-images

  * Added new theme "Clean-Blog".  Clean Blog is a fully responsive,
    mobile first HTML5/CSS3 theme built on the Bootstrap
    framework.

  * Fixed checkbox entryproperties re-sets (#376)

  * Fixed media item delete handler (#371)

  * Rewrote Routing code for index.php to be outsourced into
    include/functions_routing

  * Removed broken feature for viewing blog entries by multiple
    authors, dropped code from core and plugin_authors.

  * Optimize scaleImage returns

  * Fixed media item rename handler (#370)

  * Fixed and enhanced multiple media redirects and path / name
    related issues, as well as some better umlaut conversions

  * Allow strict media directory selection by toggle filter

  * Allow a better auto char conversion to media upload item names

  * Added Start / End pagination to MediaLibrary and entries list

  * Added new bulk image move ability to MediaLibrary, when extended
    Filters are set in Personal Preferences. This fixes several issues
    with rename AND remove and allows to automatically check and set
    MediaLibrary item entry paths on MOVE.

  * Fix importers to use the new mysqli API extension with PHP 5+

  * WIP: Added an internal cache to speedup s9y's site generation. Can
    be activated by setting use_internal_cache to true in
    serendipity_config.inc.php. Test feedback needed.

  * Added <IfModule mod_rewrite.c> checks to .htaccess for URL rewriting

  * Add support for cronjob plugin to spartacus, to notify blog owner
    about possible updates (via e-mail)

  * Added link to preview spartacus themes on blog.s9y.org

  * Added two configuration variables that can be set in
    serendipity_config_local.inc.php to influence the Dashboard entry
    limit:

    - $serendipity['dashboardLimit']: How many future entries to fetch
      (default: 5)
    - $serendipity['dashboardDraftLimit']: How many entries in total
      shall be displayed in the Dashboard section (default: 5)
    - $serendipity['dashboardCommentsLimit']: How many comments
      (default: 5)

    (Draft entries will only be fetched if there are less future
    entries than the total entry limit)

  * Fix: the syndication plugin links subtome correctly to the atom
    feed when he is activated with the rss feed

  * Issue #238: When creating/renaming media directories, replace
    special characters with the same i18n rules like Permalinks are
    created, renaming umlauts etc.

  * Add "update all"-button to plugin update page

  * Issue #234: Granular options to force backend popups for certain
    areas

  * Introduce serendipity['ajax'] to detect incoming ajax requests
    and react accordingly in core and plugins

  * Issue #248: Add $serendipity['forceBase64']=true option (can be
    set in serendipity_config_local.inc.php) to make Serendipity
    *not* use 8bit Imap functions for sending mail, for MTAs that
    behave erradically otherwise.

  * Issue #257: Make sure to check entered admin-user password

  * Issue #264: Drop $authorid for permissions based on images
    instead of directories, it was not used anymore

  * Some small enhancements to the error reporting


Version 2.0.6 ()
------------------------------------------------------------------------

  * Fix Bug #428, regression when fetching remote files, wrong call
    to HTTP_Request::getEffectiveUrl()

  * Fix Bug #433, secure variable on first time installation to prevent
    RCE, thanks to Shinkurt


Version 2.0.5 (November 28th, 2016)
------------------------------------------------------------------------

  * [Security] Improve preventing fetching local files, thanks to
    Xu Yue.

  * [Security] Prevent XSS in adding category and directory names,
    thanks to Edric Teo @smarterbitbybit.


Version 2.0.4 (September 26th, 2016)
------------------------------------------------------------------------

  * [Security] Prevent moving files by using their directory name.
    [Security] Possible SQL injection for entry category assignment
    [Security] Possible SQL injection for removing&adding a plugin

    All issues require a valid backend login.
    Thanks to Hendrik Buchwald for finding this via their
    RIPS source code analyzer (www.ripstech.com)

  * [Security] Add new configuration option to enable fetching
    local files for the media uploader. By default this is now
    disabled to prevent Server Side Request Forgery (SSRF).
    Thanks to Xu Yue for pointing this out!


Version 2.0.3 (January 4th, 2016)
------------------------------------------------------------------------

  * Fix XSS in backend comment editing form for logged-in authors,
    thanks to Onur Yilmaz and Robert Abela from Netsparker.com

  * Fix some backend entry form related event messages


Version 2.0.2 (July 24th, 2015)
------------------------------------------------------------------------

  * Fix security issues reported by Tim Coen of Curesec.com:

    - Forbid uploading files with PHP contents and possible
      PHP execution by authenticated users (critical if
      you have possible untrustworthy authors)
    - Add proper escaping for comment approval tokens to prevent
      SQL injection (authenticated authors only)
    - Add proper escaping of comment's author names in the
      comment reply form to prevent XSS (2k11 template, javascript
      based)

  * Minor layout fixes for media DB media filters

  * Backported some Importer db bugfixes

  * CKEDITOR bugfix releases to 4.4.8 - please read the changelog.
    Includes widget, lineutils, fakeobjects Plugins and S9y added
    cheatsheet and procurator Plugins.
    Changed config.autoParagraph set to false, to prevent wrapping
    p tags around extraAllowedContent tags.

  * Smarty bugfix upgrades to 3.1.27 - please read the changelog.
    Compilation time was vastly improved.
    New Features in NEW_FEATURES.txt.

  * It is now possible to switch to a theme's admin theme if it has
    been selected as a frontend theme first

  * Syndication Plugin Issue #285:
      - Add "none" as possible value for the xml-icon in the
        syndication plugin, to enable plain links
      - Reset subtome full icon path to support
        serendipity_getTemplateFile()
      - Link creation fixes for Bulletproof coloured style (eg blue)

  * Fix auto include of a User theme /admin/user.css backend file.

      PLEASE NOTE:

      2.0.1 brought in an automated include of a themes "user.css"
      file. If you don't want to use such file any more (and you have
      one), you will have to delete or rename it by hand!

      Also please note, that user stylesheet selectors like

        .selector {
            background-image: url(img/example.jpg);
        }

      now need to use the {TEMPLATE_PATH} like

        .selector {
            background-image: url({TEMPLATE_PATH}img/example.jpg);
        }

      Content of a user.css will always be put LAST into the combined
      CSS, this means it will override any possible plugin output.
      If a user.css file does not exist in your own template directory,
      but inside the default 2k11 template directory, this will always
      be used (this behaviour is called "default fallback chain").

  * Use https URLs for Atom feed, if called through HTTPS (hboeck)

  * Restore the "Show toolbar within media selector popup?" option,
    it was ignored before.

  * Fix Issue #321, negative offset for LIMIT SQL statements when
    using stable archive sorting and plugins like history.

  * Templatechooser will not apply theme in backend admin.

  * Use "secure" flag for (session) cookies sent over SSL, thanks to
    dayton967

  * Make preview_iframe.tpl template files load the proper frontend
    CSS file, including cache-busting version string when changing
    themes

  * Implement patch to properly initiate templates_c on installation
    for shared installs (thanks to fugue88)

  * Allow templatechooser plugin to read a custom "blacklist.txt"
    within its directory, that can blacklist certain themes from
    being selected.

  * Allow serendipity_setCookie() function to set custom expiry.

  * Adapt .htaccess profile of "mod_rewrite for 1&1 and problematic
    servers" to not include the "Options -MultiViews" option, since
    this is often blocked

  * Fix initializing smarty framework in the preview/saving iframe,
    so that a template's config.inc.php is always loaded.

  * Show debugging .tpl file information with relative directory only

  * fix wrong upgrade removal of dead files with 2.0.1 update


Version 2.0.1 (March 12th, 2015)
------------------------------------------------------------------------

  * Fix missing escaping (possible XSS) of category names in the
    Backend Entry Admin, which would allow editors that create a
    forged category name to attack other editors in the backend
    (privileged access to the backend required). Thanks a lot to Edric
    Teo for reporting this issue.

  * Improved detection for possible upgrade/plugin/PHP errors. A
    warning will be emitted on the Dashboard, when the Serendipity
    JavaScript library could not be loaded.

  * syndication fix: use absolute urls for subtome

  * Issue 306: localStorage may be deactivated by setting a config
    option or using security-related extensions at least in some
    browsers, which might (at least in FF) break backend JS
    functionality. Added extra tests to 2k11 backend JS.

    If you use localStorage, please test if it is actually available
    by testing if localStorage !== null in JS.

  * Issue 280: Allow every theme to utilize a "user.css" file that
    gets loaded on top of the frontend (or backend, if in admin/
    subdirectory) theme. This file can be used for customized CSS of
    a blog-admin which carries over to future Serendipity updates

  * Issue 299: Do not display Dashboard for users with no permission
    to perform actions in the backend (frontend-users)

  * Make "rewriteURL" smarty modifier available to do a
    {$CONST.PATH_ARCHIVE|rewriteURL} within a smarty template file.

  * Add a generic odd/even for backend Dashboard widgets to align
    properly. Future Dashboard widgets need to get the new extra
    class Dashboard widget on the section element they create.

  * Fix event emoticate plugin to reflect proper call usage of
    serendipity_getTemplateFile(), if a theme uses custom emoticons.
    UPDATE your themes emoticons.inc.php file, if have. See example
    file in plugin dir.

  * Change 2k11 config.inc.php to reflect proper
    serendipity_getTemplateFile() when frontend files shall be
    referenced within the backend.

  * Fixed missing file message for deleted media items

  * Fixed entry editor JS not emitting a 'No tags' msg in taxonomy
    quick view. Improved serendipity.tagsList exit if freetag plugin
    is not installed.

  * Minor backend UI fixes (taxonomy quick view in entry editor,
     'Done' msg emitted by Bayes plugin)

  * Clearer language constants for entries in Dashboard, labelled
    "In progress"


Version 2.0 (January 23rd, 2015)
------------------------------------------------------------------------

  * Smarty fix for purging compiled files

  * Fix wrong search page ordering when stable archive was active

  * Prevent entryproperties from saving/displaying a browser-side
    stored password that was actually not set.

  * Stronger check for existing logger interface to prevent errors
    when it is not actively used.

  * Fix entryproperties being removed when publishing an article
    from the Dashboard and by specific plugins (freetag, trackback)
    that modify entry data.

  * Fix deleting comments when user is not an admin, but the entry
    belongs to him. Thanks to berberic.

  * Patch PEAR.php to use "static" isError declaration to prevent
    PHP error messages

  * Change order of IF-statements in entries.tpl to check for
    comment_moderate/comment_added, to properly emit the message
    whether a comment is being moderated.

  * Fix searching for entries in the admin panel with database
    types other than "mysql"

  * Change entry editor's category assignment to toggle between
    a hierarchical and a plain list (good for many categories)

  * Fix date formatting in entry editor to not use ISO year
    but the calendar year

  * Fix autoupdate version read and transmit


Version 2.0-rc2 (December 23rd, 2014)
------------------------------------------------------------------------

  * Fixes escaping of comments in the new backend pane to prevent
    XSS. Thanks to Steffen Röemann for reporting!

  * Fix wrong parameter count in serendipity_entity_decode


Version 2.0-rc1 (includes beta4/5/6) (December 19th, 2014)
------------------------------------------------------------------------

  * entryproperties plugin will now automatically disable nl2br
    markup, when the WYSIWYG editor is used to create en entry

  * PHP Requirement now is at: PHP 5.3+

  * Fix for syndication subtome onclick handler

  * Fix problematic preview stylesheet reference

  * Optimized clearing smarty template files on upgrading

  * Properly reset the "disable markup" feature of entryproperties
    plugin when none selected

  * PHP 5.4+ fix to properly call htmlspecialchars() / htmlentities() /
    html_entity_decode() with a charset option, that has been
    set to to default to UTF-8 and will yield empty strings when
    being used in NON-UTF-8 environments. Now we utilize a
    serendipity_specialchars() wrapper call.

  * Added SQLite3 OO database layer for PHP 5.4+

  * New personal preference to choose CKEditor toolbar presets.
    Presets can be overwriten through a
    templates/xxx/admin/ckeditor_custom_config.js if needed.
    See htmlarea/ckeditor_s9y_config.js for details.

  * Proof of concept templates "default-php" and "default-xml" have
    been moved to Siber...Spartacus. They would need adapting to
    Serendipity 2.0 (simple methods like getConfigDir() et al),
    but since those Template APIs have virtually zero usage scenario,
    they remain experimental.

  * Added new PAT_JS mod_rewrite rule to .htaccess files

  * Removed experimental support for PHP/SMARTY IN-MEMORY caching
    added in 2.0-beta3, since this could not work.

  * Smarty 3.1.21 upgrade (see changelog)

  * Fix ImageMagick new sizing issues while forcing image geometry
    exactly to given sizes with imageselectorplus

  * Fix issue #220 with pdf directory moving rename() error

  * Fix bug in entry listing, which showed wrong categories for
    entries (Issue #201)

  * Improve RegExp for Feed-URL matching, thanks to fugue88

  * Proper SQLite PDO filenames in shared installations (Issue #214)

  * ImageMagick now can get parameters to generate thumbnails,
    see serendipity_config.inc.php for example values

  * Allow to enable/disable the new autosave feature in personal
    preferences (Issue #213)

  * Re-added installer test for writable serendipity base directory


Version 2.0-beta3 (July 25th, 2014)
------------------------------------------------------------------------

  * Move admin/media_showitem.tpl to theme's directory in 2k11. With
    an adaptation in serendipity_admin_image_selector.php, this now is
    a "true" frontend template which uses the styles of the frontend
    theme. Theme authors might want to adapt it to their themes.

  * Moved general syndication plugin option into the core

  * Smarty 3.1.19 upgrade (see changelog)

  * Fixed thumbnail recreation, Issue #134

  * Merged external JS libraries into a central "plugins.js" of the 2k11
    backend template, can be updated through
    templates/2k11/admin/js/gruntipity.php helper script.

  * Adapted database table structure change for statistics, shoutbox,
    karma and spamblock plugin (for new field definition of "ip" field)
    Thanks to rohdef!

  * Added new option "enabledBackendPopups" that allow to specify
    if inline modal dialogs or popups are used in the backend for
    e.g. the category selectory and media library

  * added experimental support for PHP/SMARTY IN MEMORY caching
    Enabled by default, if classes found loaded.
    Disable with
      $serendipity['disable_apc'] = true;
    and
      $serendipity['disable_memcache'] = true;

  * Support added in serendipity_db_schema_import for sqlite
    autoincrement

  * Remove Google Reader button from syndication plugin options

  * Add subToMe-button to syndication plugin and change its defaults

  * Use Browsercache to save cache and restore entries

  * Improved installer to forbid using database table prefixes with
    special characters

  * Themes using Engines are now able to use the parent's
    configuration

  * Prevent "new" plugin api to install double instances of plugins
    that are not stackable (issue #45)

  * Back button in plugin-config

  * Adapted serendipity_editor.js to provide more global (though
    deprecated) API access methods for plugins like amazonchooser
    and linktrimmer, to perform insertion. Also fixed the
    insertion of text when the ID of the element is not prefixed

  * Move sort by name to simple filter in ML, replace file extension

  * Remember selected media library folder

  * Show upload-success or error with the ajax image uploader

  * Fix preview entry exception (issue #119)

  * Add serendipity.toggle_collapsible as a reusable JS function
    for the core backend and backend sections emitted by plugins as
    an easy way to provide show/hide functionality. (yellowled)

  * Fixed media insert target bug (issued by #143, #145, #121)

  * Fixed publish drafted-entries via Dashboard (issue #160)

  * All frontend themes that rely on the bundled Core jQuery library
    are currently using the jquery.noConflict-mode for compatibility
    to older plugins.
    This mode is now considered deprecated and will be removed in
    future releases. A new variable:
      $serendipity['capabilities']['jquery-noconflict'] = false;
    in your theme's config.inc.php file can now turn of that
    noConflict-mode.

  * Due to distinction of backend and frontend themes, each theme
    that provides a custom jquery.js now only does so for the
    frontend. The backend now listens to a:

      $serendipity['capabilities']['jquery_backend'] = false;

    variable, and the file needs to be jquery_backend.js that
    a backend theme would reference to.

  * Changed 2k11's config.inc.php file to provide a more stable
    call of event hooks so that other themes can also hook
    their own events.

  * Changed JS for category filtering and its reset button to be a
    reusable function, which is now also used in the list of
    installable plugins.

  * Fixed wrong local documentation URL in plugin configuration

  * Added new "backend_dashboard" event-hook for plugins to use
    within Dashboard.

  * Backend and Frontend themes can now be set independently from
    each other. New backend themes now need to set:

      Backend: Yes

    in their info.txt file. If you adapt a custom admin theme,
    ensure that it is compatible to the new "2k11" backend to
    ensure proper future usage within Serendipity. The bulletproof
    backend will now no longer be recognized as a backend theme
    option, but can be selected as a new frontend theme, while
    using 2k11 (=default) in the backend.

  * Include klogger, call it as $serendipity['logger']->debug/error.
    The log-level can be set in the general configuration and is
    disabled by default.

  * Fixed missing s9ymdb ID

  * Add HTTP_Request2 and dependencies as bundled libraries and
    update PEAR library to version 1.9.4

  * Implemented AJAX uploadResize option to allow resizing an image
    before upload (onli)

  * Improved file/directory removal code to (hopefully) fail more
    gracefully

  * Change "default" admin backend template fallback chain so that
    old admin themes can theoretically be shown with the "old"
    admin interface. This however in many themes breaks the
    Serendipity workflow. In other words, currently old custom backend
    themes are deprecated. We are still working on how to deal
    with this and if we can add some sort of compatibility or port.

  * Fix bundled jquery's source mapping, upgraded to 1.11.1

  * Fixed missing media name in resize GET URL

  * Fix MediaDB overlay display

  * Re-Added possibility to change filename/target directory for
    media uploads

  * Update CKEditor to 4.4

  * Fixed some missing internationalization instances

  * Minor CSS improvements for upgrader, plugin sequencing widget

  * RSS importer accepts pubDate in addition to pubdate element.

  * Upgrader in Dashboard can be disabled, returns error message when
    URL is not accessible

  * Added a category filtering ability for the entry editor

  * Better check when removing old/dead files to prevent error
    messages

  * WYSIWYG editor respects image floats

  * Support html5 multiple file upload

  * Modernizr, magnificPopup updates

  * Improvements to equal heights js, button labels

  * No longer truncate long entry titles

  * Improve non-WYSIWYG editor tag insertion, url insertion

  * Improve less DOM firing on certain javascript tasks

  * Introduce js_backend event hook


Version 2.0-beta1 and followup -beta2 (April 14th, 2014)
------------------------------------------------------------------------

  * Upgrade Smarty libs to 3.1.18

  * Automatic upgrade removal of old Smarty2 files (2.0-alpha2)
    function uses SPL

  * Implemented patch https://github.com/s9y/Serendipity/pull/15

  * When switching Themes, both the backend and the frontend
    will remember the timestamp of the last theme change,
    to make sure that the browser will not cache a mismatching CSS.

  * Fix theme change issues with global template vars in core
    (1559472ca3) see 'temporary added empty $template_config_groups'
    in 1.7-rc2 (eb77dc369a)

  * Use Smarty for backend display output

  * "Themes" are now what has previously been mixed as "Design",
    "Theme", "Template" or "Layouts".

  * WYSIWYG-Spawn-API reworked (2k11/admin/wysiwyg_init.tpl)

  * All Javascript-functions like SetCookie now reside in a
    serendipity-object, simulating a namespace.
      SetCookie(...)
    became
      serendipity.SetCookie(...)

  * Renamed JS-Function:
      toggleCategorySelector became toggle_category_selector

  * The advanced js option (eyecandy) got removed, as such a thing
    like advanced js doesn't exist anymore

  * dashboard_plugin has an equivalent in the core, replacing the
    frontpage

  * Constants like S9Y_FRAMEWORK_COMPAT are no longer set
    (include_once is used instead)

  * New additional option to render smarty-functions:
    serendipity_smarty_show($template, $data)

  * A number of functions now returns their result instead of echoing
    them (TODO: a bunch of image- and
    trackback-functions still use echo for messages"):
      serendipity_plugin_config
      serendipity_printEntryForm
      serendipity_printEntries
      function serendipity_showMedia
      serendipity_showPropertyForm
      showMediaLibrary
      serendipity_guessInput
      memSnap
      serendipity_displayTopUrlList
      serendipity_displayTopExits
      serendipity_displayTopReferrers
      serendipity_printConfigTemplate
      show_plugins

  * Functions removed from the core:
      serendipity_printConfigJS

  * Functions added to the core:
      serendipity_generateImageSelectorParams

  * All internal plugins got extracted from plugin_internal.inc.php
    and moved to plugins/.
    They are renamed to work there (upgrader task provides migration):
      serendipity_calendar_plugin    became serendipity_plugin_calendar
      serendipity_quicksearch_plugin became serendipity_plugin_quicksearch
      serendipity_archives_plugin    became serendipity_plugin_archives
      serendipity_categories_plugin  became serendipity_plugin_categories
      serendipity_syndication_plugin became serendipity_plugin_syndication
      serendipity_superuser_plugin   became serendipity_plugin_superuser
      serendipity_plug_plugin      became serendipity_plugin_plug

  * Add plugin hook "js", generating a virtual serendipity.js

  * Admin JS is now bundled in serendipity_editor.js.tpl and
    rendered using smarty in the theme config

  * Admin JS got rewritten using jQuery where applicable

  * serendipity_define.js.php removed

  * Removed support for layout.php

  * The whole PHP-Code now almost never echoes integrated HTML, but
    uses smarty template (TODO: Remove the almost)
    The necessary smarty-templates reside in 2k11/admin/
    Every theme can generate its own backend if it integrates those
    templates under admin/ itself

  * 2k11 is set as the new default backend, replacing bulletproof.
    default remains the fallback so far.

  * A number of functions had some arguments removed:
    * function serendipity_displayImageList:
        From
            function serendipity_displayImageList($page = 0, $lineBreak = NULL, $manage = false, $url = NULL, $show_upload = false, $limit_path = NULL, $smarty_display = true)
        to
            function serendipity_displayImageList($page = 0, $lineBreak = NULL, $manage = false, $url = NULL, $show_upload = false, $limit_path = NULL)
    * function serendipity_showMedia
        From
            function serendipity_showMedia(&$file, &$paths, $url = '', $manage = false, $lineBreak = 3, $enclose = true, $smarty_vars = array(), $smarty_display = true)
        to
            function serendipity_showMedia(&$file, &$paths, $url = '', $manage = false, $lineBreak = 3, $enclose = true, $smarty_vars = array())
    * generate_plugins
        From
            static function generate_plugins($side, $tag = '', $negate = false, $class = null, $id = null, $tpl = 'sidebar.tpl')
        to
            static function generate_plugins($side, $negate = false, $class = null, $id = null, $tpl = 'sidebar.tpl')

  * serendipity_showMedia now no longer returns the used template and
    echoes the generated HTML, but only returns the generated HTML

  * Themes now have their own configuration page,
    ?serendipity[adminModule]=templates&serendipity[adminAction]=editConfiguration

  * jQuery in the backend no longer runs in noConflict-mode. Use
    $(...) instead of jQuery(...)

  * The entryproperty-plugin will now always delete its cache on
    uninstall, not only if the cache is activated then

  * serendipity_is_iframe now really only checks for iframe and
    doesn't also echo it

  * Added option simpleFilters (meant to indicate to show less
    filters and poweruser-options)

  * serendipity_admin_image_selector.php no longer used by 2k11,
    instead the media library (with admin/media_choose.tpl,
    admin/media_upload.tpl, media_pane.tpl, media_items.tpl)
    can generate the imageselector on its own. The editor calls
    serendipity_admin.php?serendipity[adminModule]=media instead,
    with serendipity[textarea] indicating the target, and
    serendipity[showMediaToolbar] activating the imageSelector modus

  * New required PHP-Version: 5.3 or higher (checked in the installer)


Version 1.7.8 (February 9th, 2014)
------------------------------------------------------------------------

  * Fixed POST for db entry insert, caused by 1.7.6 security feature


Version 1.7.7 (February 6th, 2014)
------------------------------------------------------------------------

  * Fixed PHP parse error in templatechooser plugin. Blame garvin. :(


Version 1.7.6 (February 6th, 2014)
------------------------------------------------------------------------

  * Fixed backend security issues, thanks to Stefan Schurtz:

      - XSS of users realname in "Manage users" section
        (Backend, requires login)
      - XSS when creating an entry with bad id/timestamp values
        (Backend, requires login)
      - SQL-Injection for plugin installation parameter
        (Backend, requires admin login)

  * Templatechooser plugin uses "default" template as fallback,
    not "bulletproof".


Version 1.7.5 (January 18th, 2014)
------------------------------------------------------------------------

  * Fixed textile PHP 5.2 (namespace) compat issue

  * Added default value to spamblocks required_fields option [name,
    comment]


Version 1.7.4 (January 11th, 2014)
------------------------------------------------------------------------

  * Fixed emoticate plugin icon link to check for textile class

  * Upgrade textile plugin libs - lib3 extends to PHP >= 5.3.
    Please check for new options!

  * Fixed spamblocks Captcha imagecreate() with PHP > 5.3 versions

  * Smarty 3.1.16 bugfix release - please read bundled-libs/Smarty/change_log.txt
    about changes to versions 3.1.16 and 3.1.15.
    Please also see special bundled-libs/Smarty/3.1.16_RELEASE_NOTES.txt

  * Removed blogg.de filter from spamblock plugin, adapted htaccess
    IP block algorithm for race conditions. .htaccess can now contain
    multiple Deny From ranges to prevent parsing problems (DLange)

  * Fixed IP columns in spamblocklog, spamblock_htaccess, karmalog, visitors
    and shoutbox to varchar(45) for IPv6 - including tunneled IPv4 (39+6)

  * Fixed possible double includement of plugin_internal.inc.php

  * Fix possible temporary caching errors failing $eventData[0]['properties']

  * Basic support for static blocks (includeentry plugin) in 2k11.

  * Added "backend_footer" event hook

  * Exclude "frontpage extensions" directories "_vti_cnf" on windows servers
    in Media Library

  * Fixed pagination when searching terms with fetchlimit < 4

  * Fixed deprecated /e modifier with PHP >= 5.5 in nl2br plugin restore method


Version 1.7.3 (August 28th, 2013)
------------------------------------------------------------------------

  * Trackback to https:// style URLs will use proper port 443 instead
    of 80.

  * Disabled htmlarea spellchecker module, http://osvdb.org/87395
    Thanks for Henri Salo for pointing this out. CVE-2013-5670


Version 1.7.2 (July 26th, 2013)
------------------------------------------------------------------------

  * Fix a syntax error in the "mysql" deprecation code, thanks
    to Ian


Version 1.7.1 (July 26th, 2013)
------------------------------------------------------------------------

  * Added new event hooks "backend_plugins_install", "backend_plugins_update"
    and "backend_templates_install".

  * Serendipity will switch to mysqli if PHP >= 5.5 is used (mysql
    is deprecated)

  * Smarty upgrade to 3.1.14 (read changeLog and the README for API changes since Smarty 2)

  * Upgrader will now remove/delete the browsercompatibility plugin

  * Fixed Media Library exclude path to not show/proceed ckeditor/kcfinders .thumbs dir

  * Fixed bulletproof->colorset GET mismatch with categorytemplates plugin
    config.inc.php [Line 29]

  * German translation for stable archives added (YL)

  * Fixed curl result bug in spartacus plugin

  * Create new migration task for propagate defaultBaseURL when
    currently empty (onli)

  * Fixed statistics sidebar querys ( & for PostgreSQL ) [242520b]
    and added some missing html end tags

  * Added missing current group name when editing usergroups


Version 1.7 (May 11th, 2013)
------------------------------------------------------------------------

  * rc4: Get ready for CKEDITOR-wysiwyg Plugin mode

  * rc4: Fixed fetching javascript object (for nugget textareas) in non-wysiwyg-mode

  * rc4: Change .htaccess blocking mechanism by spamblock plugin to not fetch
    too many datarows, thanks to DLange from the forums. (The .htaccess
    feature is still considered experimental, use at your own risk ;))

  * rc4: Fixed entryproperties backend 'cache now' link

  * rc3 + rc4: Media database: Escape more Cookie values to prevent storing
    possible XSS (http://board.s9y.org/viewtopic.php?f=3&t=19142).
    Escape hotlinked media filename. Escape importer host name error
    Thanks to GreenSun from the forums for bringing this to attention,
    originally reported by Dshellnoi Unix

  * rc2: Alter entries.tpl to add the line:
    {assign var="entry" value=$entry scope="parent"}
    for proper propagation of $entry to sub-templates.

  * rc2: Alter error reporting to only fail when 'debug' mode is enabled,
    so that "normal" blog installations will not fail on specific
    E_STRICT warnings that are not important.

  * rc2: temporary added empty $template_config_groups into templates with config,
    to avoid display troubles for template changes, if previous template had these set.
    Please check your template.

  * rc2: reflect POST submitted changes in Bulletproof template configs re-set situations

  * various PHP 5 compatibility fixes in core and plugins

  * Allow entryproperties plugin to define defaults for custom fields

  * Onyx, Net_URL classes: Remove PHP4 style constructor due to
    PHP5 error "Constructor already defined"

  * Improved RSS sidebarplugin to support Atom

  * Bundled simplepie

  * For Blogs running on a non-UTF-8 language, set a Smarty constant
    to indicate the actually used charset.

  * Added to use MyISAM handler for s9y tables (we do not use InnoDB
    features, but rely on MyISAM fulltext)

  * fixed defaultBaseURL did not show up installer. Thanks to onli.
    Follow up from c292bad

  * fixed draft & future entries preview link in backend

  * Improved karmarating plugin to be able to use AJAX calls
    (gregman)

  * Allow Smarty to fetch .tpl files from all directories so that
    s9y plugin can use the fetch() call for their .tpl files no
    matter which (symlinked) directory the plugin resides in.
    The Smarty security policy to us only serves as a restriction
    within .tpl files to not allow arbitrary PHP modifier/function calls.
    If in the future Smarty supports enforcing trustedDir checks on
    {include} calls separately to smarty->fetch() calls, we'll also
    add that to .tpl files.
    (garvinhicking)

  * Patch by Markus Brükner: Properly handle files that have no
    extension in media database

  * Made Spartacus recognize github.com mirror (garvinhicking)

  * Add "Summary" output to title of summary archive pages, patch by
    hboeck

  * Set the smarty object by instance (ophian)
    It is often needed to access the Smarty object from anywhere in your code, e.g. in plugins
    We now ensure that there is only one instance of the object available.
    To obtain an instance of this class: $serendipity['smarty'] = Serendipity_Smarty::getInstance();
    The first time this is called a new instance will be created. Thereafter, the same instance is handed back.
    To overwrite use $serendipity['smarty'] = new Serendipity_Smarty; to create a new instance.

  * Set a global Serendipity errorToExceptionHandler (ophian)
    changed some old smarty trigger_errors to PHPs native function

  * Updated spamblock plugin (ophian)
    changed wordfilter to function and Commenters moderation check verify_once
    to get checked via wordfilter to reject known spam comments before

  * Changed backend comment (error) messages  (ophian)
    as now captured and styleable messages
    (newly added .serendipity_backend_msg_notice css class)

  * Updated nl2br plugin (ophian)
    added isolation tag using nl to br
    this also adds some NoBR buttons to backend entry forms

  * Smarty3 support (ophian)
    with this upgrade Serendipity / Smarty will at least need a webserver running the PHP 5.2 series.
    As of August 2011, all PHP users should note, that the PHP 5.2 series is NOT supported anymore by the PHP developers.
    All users are strongly encouraged to upgrade to PHP 5.3.8 and up. Please refer to your ISP about this.

  * Added new serendipity['defaultBaseURL'] variable that makes sure
    that the baseURL is not overriden when configuring serendipity
    with a possibly autodetected currentl URL. Patch by Manko10.


(Older NEWS see file NEWS_OLD)

